# دليل الإصلاح السريع لمشكلة Storage

## المشكلة
- خطأ RLS: `new row violates row-level security policy`
- الـ buckets غير موجودة في Storage
- RLS معطل في جدول `lost_pets`

## الحل السريع

### الخطوة 1: تشغيل SQL في Supabase
1. اذهب إلى Supabase Dashboard
2. اختر مشروع "PatiWorld"
3. اضغط على "SQL Editor" من القائمة الجانبية
4. انسخ والصق محتوى ملف `SQL_FIXES.sql`
5. اضغط "Run" لتنفيذ الكود

### الخطوة 2: التحقق من النتائج
بعد تشغيل SQL، يجب أن ترى:
- ✅ RLS مفعل في جدول `lost_pets`
- ✅ الـ buckets `pet-images` و `profile-images` موجودة
- ✅ السياسات الأمنية مطبقة

### الخطوة 3: اختبار التطبيق
1. أعد تشغيل التطبيق
2. جرب إضافة حيوان مفقود مع صورة
3. يجب أن تعمل الآن بدون أخطاء

## ما يفعله SQL:

### 1. تفعيل RLS
```sql
ALTER TABLE public.lost_pets ENABLE ROW LEVEL SECURITY;
```

### 2. إنشاء السياسات الأمنية
- السماح للجميع بقراءة الحيوانات المفقودة النشطة
- السماح للمستخدمين المسجلين بإضافة حيوانات مفقودة
- السماح للمستخدمين بتحديث/حذف حيواناتهم فقط

### 3. إنشاء Storage Buckets
- `pet-images`: للحيوانات المفقودة والحيوانات للتبني
- `profile-images`: للملفات الشخصية

### 4. سياسات Storage
- السماح للجميع بقراءة الصور
- السماح للمستخدمين المسجلين برفع الصور
- السماح للمستخدمين بإدارة صورهم

## إذا استمرت المشكلة:
1. تحقق من أن المستخدم مسجل دخول
2. تحقق من أن الـ buckets تم إنشاؤها بنجاح
3. تحقق من أن RLS مفعل
4. راجع logs في Supabase Dashboard
